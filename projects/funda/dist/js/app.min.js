"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var APP=APP||{};APP.launcher=function(){function e(){document.addEventListener("DOMContentLoaded",function(){APP.geo.getLocation()})}return{init:e}}(),APP.launcher.init(),APP.data=function(e){function t(e){return new Promise(function(t,o){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){this.status>=200&&this.status<300?t(n.response):o({status:this.status,statusText:n.statusText})},n.onerror=function(){o({status:this.status,statusText:n.statusText})},n.send()})}function o(e){var t="json",o="e2d60e885b8742d4b0648300e3703bd7",n="koop",e=e,i="1",a="25",r="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+t+"/"+o+"/?type="+n+"&zo=/"+e+"&page="+i+"&pagesize="+a;APP.data.request(r).then(function(t){var o=JSON.parse(t),n=[];[].forEach.call(o.Objects,function(e){if(1==e.HeeftVideo){var t={id:e.Id};n.push(t)}}),console.log(n),APP.router.init(n,e)})}function n(e){var t="json",o="e2d60e885b8742d4b0648300e3703bd7",n="koop",e=e,i="1",a="25",r="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+t+"/"+o+"/?type="+n+"&zo=/"+e+"&page="+i+"&pagesize="+a;APP.data.request(r).then(function(e){var t=JSON.parse(e);console.log(t);var o=[];[].forEach.call(t.Objects,function(e){var t={id:e.Id,title:e.Adres,photo:e.FotoLargest,postalcode:e.Postcode,place:e.Woonplaats,price:e.Prijs.Koopprijs};o.push(t)}),console.log(o),APP.page.houseFavourites(o)})}function i(e){var t="json",o="e2d60e885b8742d4b0648300e3703bd7",e=e,n="koop",i="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+t+"/detail/"+o+"/"+n+"/"+e+"/";APP.data.request(i).then(function(e){var t=JSON.parse(e);console.log(t);var o,n,i,a=[];for(o=0;o<t.Media.length-12;o++)n=t.Media[o],void 0!=n.MediaItems[3]&&(i=n.MediaItems[3].Url),console.log(i),a.push({photo:i});console.log(a);var r=[],s={id:t.InternalId,title:t.Titels[0].Omschrijving,photos:a,description:t.VolledigeOmschrijving,price:t.KoopPrijs,url:t.URL};r.push(s),console.log(r),APP.page.houseDetail(r)})}function a(e,t){var o="json",n="e2d60e885b8742d4b0648300e3703bd7",e=e,i="koop",a="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+o+"/detail/"+n+"/"+i+"/"+e+"/";APP.data.request(a).then(function(o){var n=JSON.parse(o),i=function(o){var n=0,i=t.length;for(n;i>n;n+=1)if(t[n].id===e)return t[n+1];return"not found"},a=function(o){var n=0,i=t.length;for(n;i>n;n+=1)if(t[n].id===e)return t[n-1];return"not found"},r=i(e),s=a(e);if(void 0==s)var u={id:e,nextID:r.id,title:n.Titels[0].Omschrijving,buyPrice:n.Prijs.Koopprijs,videoURL:n.Video.Videos[0].Cdns[0].Url};else if(void 0==r)var u={id:e,prevID:s.id,title:n.Titels[0].Omschrijving,buyPrice:n.Prijs.Koopprijs,videoURL:n.Video.Videos[0].Cdns[0].Url};else var u={id:e,nextID:r.id,prevID:s.id,title:n.Titels[0].Omschrijving,buyPrice:n.Prijs.Koopprijs,videoURL:n.Video.Videos[0].Cdns[0].Url};console.log(u),APP.page.houseVideo(u)})}return _defineProperty({request:t,getHouses:o,getHouseFavourites:n,getHouseVideo:a,getHouseDetail:i},"getHouseDetail",i)}(),APP.geo=function(){function e(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t,o,{enableHighAccuracy:!0,maximumAge:0})}function t(e){var t=["http://nominatim.openstreetmap.org/reverse?format=json&lat=","&lon="],o=e.coords.latitude,n=e.coords.longitude,i="&zoom=13&addressdetails=1",a=t[0]+o+t[1]+n+i;APP.data.request(a).then(function(e){var t=JSON.parse(e),o=t.address.city||t.address.town;localStorage.setItem("Location",o),console.log(o),APP.data.getHouses(o)})}function o(){console.log("an error has occured")}return{getLocation:e,displayPosition:t}}(),APP.page=function(){function e(e){APP.data.request("./dist/templates/house-videos.mst").then(function(t){n.innerHTML=Mustache.render(t,e),i.classList.remove("active"),APP.storage.init()})}function t(e){APP.data.request("./dist/templates/house-detail.mst").then(function(t){n.innerHTML=Mustache.render(t,e),i.classList.remove("active")})}function o(e){if(null!=localStorage.getItem("houseID"))var t=localStorage.getItem("houseID");else var t=[];var e=e.filter(function(e){return-1!=t.indexOf(e.id)});console.log(e),APP.data.request("./dist/templates/house-favourites.mst").then(function(t){n.innerHTML=Mustache.render(t,e),i.classList.remove("active"),APP.storage.init()})}var n=document.querySelector("main"),i=document.getElementById("loader");return{houseVideo:e,houseDetail:t,houseFavourites:o}}(),APP.router=function(){function e(e,t){window.location.hash||(window.location="#videoID="+e[0].id),routie({"videoID=:ID":function(t){APP.data.getHouseVideo(t,e)},"houseDetail=:ID":function(e){APP.data.getHouseDetail(e)},favourites:function(){APP.data.getHouseFavourites(t)}})}return{init:e}}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};APP.storage=function(){function e(){function e(e){e.preventDefault();var i=this.getAttribute("value");o.push(i),this.classList.remove("active");for(var a=0;a<n.length;a++){for(var r=n[a],s=0,u=0;u<n.length;u++)n[u]==o[a]&&s++;if(s>1)for(var c=0;c<n.length;c++)n[c]==r&&(n.splice(c,1),c-=1)}[].forEach.call(n,function(e){var t=document.querySelector('.favourite-btn[value="'+e+'"]');t&&t.classList.add("active")}),t("houseID",n)}function t(e,t){function o(e,t,o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var i="; expires="+n.toGMTString();document.cookie=e+"="+t+i+"; path=/"}function n(e){for(var t=e+"=",o=document.cookie.split(";"),n=0,i=o.length;i>n;n++){for(var a=o[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null}var i;try{localStorage.test=1,i=!0}catch(a){i=!1}if("undefined"!=typeof t&&null!==t&&("object"===("undefined"==typeof t?"undefined":_typeof(t))&&(t=JSON.stringify(t)),i?localStorage.setItem(e,t):o(e,t,30)),"undefined"==typeof t){i?data=localStorage.getItem(e):data=n(e);try{data=JSON.parse(data)}catch(a){data=data}return data}null===t&&(i?localStorage.removeItem(e):o(e,"",-1))}if(null===localStorage.getItem("houseID")||""===localStorage.getItem("houseID"))var o=[];else var o=JSON.parse(localStorage.getItem("houseID"));var n=o,i=document.querySelectorAll(".favourite-btn");[].forEach.call(n,function(e){var t=document.querySelector('.favourite-btn[value="'+e+'"]');t&&t.classList.add("active")}),[].forEach.call(i,function(t){t.addEventListener("click",e,!1)})}return{init:e}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5taW4uanMiLCJhcHAuanMiLCJkYXRhLmpzIiwiZ2VvLmpzIiwicGFnZXMuanMiLCJyb3V0ZXIuanMiLCJzdG9yYWdlLmpzIl0sIm5hbWVzIjpbIl9kZWZpbmVQcm9wZXJ0eSIsIm9iaiIsImtleSIsInZhbHVlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJBUFAiLCJsYXVuY2hlciIsImluaXQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJnZW8iLCJnZXRMb2NhdGlvbiIsImRhdGEiLCJjaXR5IiwicmVxdWVzdCIsInVybCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwib25sb2FkIiwidGhpcyIsInN0YXR1cyIsInJlc3BvbnNlIiwic3RhdHVzVGV4dCIsIm9uZXJyb3IiLCJzZW5kIiwiZ2V0SG91c2VzIiwib2JqZWN0VHlwZSIsImFwaUtleSIsInR5cGUiLCJwYWdlTnVtYmVyIiwicGFnZVNpemUiLCJhcGlVUkwiLCJ0aGVuIiwiaG91c2VEYXRhIiwiSlNPTiIsInBhcnNlIiwiaG91c2VJRHMiLCJmb3JFYWNoIiwiY2FsbCIsIk9iamVjdHMiLCJob3VzZSIsIkhlZWZ0VmlkZW8iLCJJRHMiLCJpZCIsIklkIiwicHVzaCIsImNvbnNvbGUiLCJsb2ciLCJyb3V0ZXIiLCJnZXRIb3VzZUZhdm91cml0ZXMiLCJvYmplY3QiLCJvYmplY3RzIiwidGl0bGUiLCJBZHJlcyIsInBob3RvIiwiRm90b0xhcmdlc3QiLCJwb3N0YWxjb2RlIiwiUG9zdGNvZGUiLCJwbGFjZSIsIldvb25wbGFhdHMiLCJwcmljZSIsIlByaWpzIiwiS29vcHByaWpzIiwicGFnZSIsImhvdXNlRmF2b3VyaXRlcyIsImdldEhvdXNlRGV0YWlsIiwiSUQiLCJpIiwibWVkaWEiLCJsYXJnZVBob3Rvc1VybCIsInBob3RvcyIsIk1lZGlhIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiTWVkaWFJdGVtcyIsIlVybCIsIkludGVybmFsSWQiLCJUaXRlbHMiLCJPbXNjaHJpanZpbmciLCJkZXNjcmlwdGlvbiIsIlZvbGxlZGlnZU9tc2NocmlqdmluZyIsIktvb3BQcmlqcyIsIlVSTCIsImhvdXNlRGV0YWlsIiwiZ2V0SG91c2VWaWRlbyIsImhvdXNlRGV0YWlsRGF0YSIsIm5leHRJdGVtIiwibWF4IiwicHJldkl0ZW0iLCJuZXh0SUQiLCJwcmV2SUQiLCJidXlQcmljZSIsInZpZGVvVVJMIiwiVmlkZW8iLCJWaWRlb3MiLCJDZG5zIiwiaG91c2VWaWRlbyIsIm5hdmlnYXRvciIsImdlb2xvY2F0aW9uIiwiZ2V0Q3VycmVudFBvc2l0aW9uIiwiZGlzcGxheVBvc2l0aW9uIiwiZGlzcGxheUVycm9yIiwiZW5hYmxlSGlnaEFjY3VyYWN5IiwibWF4aW11bUFnZSIsInBvc2l0aW9uIiwiZ3BzVG9DaXR5IiwibGF0IiwiY29vcmRzIiwibGF0aXR1ZGUiLCJsb24iLCJsb25naXR1ZGUiLCJ6b29tIiwiQ2l0eVVybCIsImNpdHlEYXRhIiwiYWRkcmVzcyIsInRvd24iLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwidGVtcGxhdGUiLCJfbWFpblNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiTXVzdGFjaGUiLCJyZW5kZXIiLCJfbG9hZGVyIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwic3RvcmFnZSIsImdldEl0ZW0iLCJmaWx0ZXIiLCJjIiwiaW5kZXhPZiIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRFbGVtZW50QnlJZCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaGFzaCIsInJvdXRpZSIsInZpZGVvSUQ9OklEIiwiaG91c2VEZXRhaWw9OklEIiwiZmF2b3VyaXRlcyIsIl90eXBlb2YiLCJTeW1ib2wiLCJpdGVyYXRvciIsImNvbnN0cnVjdG9yIiwic3RvcmVJRCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJjbGlja2VkSUQiLCJnZXRBdHRyaWJ1dGUiLCJhcnJheUlEIiwiaCIsIm5ld0FycmF5SUQiLCJjdXJJdGVtIiwiZm91bmRDb3VudCIsImoiLCJzcGxpY2UiLCJfZmF2b3VyaXRlQnV0dG9uSUQiLCJhZGQiLCJhZGRTdG9yYWdlIiwiY3JlYXRlQ29va2llIiwiZXhwIiwiZGF0ZSIsIkRhdGUiLCJzZXRUaW1lIiwiZ2V0VGltZSIsImV4cGlyZXMiLCJ0b0dNVFN0cmluZyIsImNvb2tpZSIsInJlYWRDb29raWUiLCJuYW1lRVEiLCJjYSIsInNwbGl0IiwiY2hhckF0Iiwic3Vic3RyaW5nIiwibHNTdXBwb3J0IiwidGVzdCIsImUiLCJzdHJpbmdpZnkiLCJyZW1vdmVJdGVtIiwiX2Zhdm91cml0ZUJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iXSwibWFwcGluZ3MiOiJBQUFBLFlBMkJBLFNBQVNBLGlCQUFnQkMsRUFBS0MsRUFBS0MsR0FBaUssTUFBcEpELEtBQU9ELEdBQU9HLE9BQU9DLGVBQWVKLEVBQUtDLEdBQU9DLE1BQU9BLEVBQU9HLFlBQVksRUFBTUMsY0FBYyxFQUFNQyxVQUFVLElBQWtCUCxFQUFJQyxHQUFPQyxFQUFnQkYsRUN2QjNNLEdBQUlRLEtBQU1BLE9BTVZBLEtBQUlDLFNBQVksV0FFWixRQUFTQyxLQUNMQyxTQUFTQyxpQkFBaUIsbUJBQW9CLFdBQzFDSixJQUFJSyxJQUFJQyxnQkFJaEIsT0FDSUosS0FBTUEsTUFLZEYsSUFBSUMsU0FBU0MsT0NyQmJGLElBQUlPLEtBQVEsU0FBVUMsR0FDbEIsUUFBU0MsR0FBUUMsR0FDYixNQUFPLElBQUlDLFNBQVEsU0FBVUMsRUFBU0MsR0FDbEMsR0FBSUMsR0FBTSxHQUFJQyxlQUNkRCxHQUFJRSxLQUFLLE1BQU9OLEdBQUssR0FDckJJLEVBQUlHLE9BQVMsV0FDTEMsS0FBS0MsUUFBVSxLQUFPRCxLQUFLQyxPQUFTLElBQ3BDUCxFQUFRRSxFQUFJTSxVQUVaUCxHQUNJTSxPQUFRRCxLQUFLQyxPQUNiRSxXQUFZUCxFQUFJTyxjQUk1QlAsRUFBSVEsUUFBVSxXQUNWVCxHQUNJTSxPQUFR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QUssS0FDN0UwRixJQUNGQSxFQUFtQmhDLFVBQVVpQyxJQUFJLGVBS2hDeEgsUUFBUUMsS0FBSzZJLEVBQWtCLFNBQVNFLEdBRWpDQSxFQUFPaEwsaUJBQWlCLFFBQVMySSxHQUFTLEtBK0hyRCxPQUNPN0ksS0FBTUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdE5BTUVTUEFDRVxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xudmFyIEFQUCA9IEFQUCB8fCB7fTtcbid1c2Ugc3RyaWN0JztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgIExBVU5DSCBBUFBcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5sYXVuY2hlciA9IGZ1bmN0aW9uICgpIHtcblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEFQUC5nZW8uZ2V0TG9jYXRpb24oKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xufSgpO1xuXG5BUFAubGF1bmNoZXIuaW5pdCgpO1xuJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdERBVEEgUkVRVUVTVFxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuQVBQLmRhdGEgPSBmdW5jdGlvbiAoY2l0eSkge1xuICAgIGZ1bmN0aW9uIHJlcXVlc3QodXJsKSB7XG4gICAgICAgIC8vIHNyYzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAwODExNC9ob3ctZG8taS1wcm9taXNpZnktbmF0aXZlLXhoclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA+PSAyMDAgJiYgdGhpcy5zdGF0dXMgPCAzMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRoaXMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGhpcy5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHhoci5zdGF0dXNUZXh0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeGhyLnNlbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlcyhjaXR5KSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIHR5cGUgPSAna29vcCcsXG4gICAgICAgICAgICBjaXR5ID0gY2l0eSxcbiAgICAgICAgICAgIHBhZ2VOdW1iZXIgPSAnMScsXG4gICAgICAgICAgICBwYWdlU2l6ZSA9ICcyNScsXG4gICAgICAgICAgICBhcGlVUkwgPSAnaHR0cDovL2Z1bmRhLmt5cmFuZGlhLm5sL2ZlZWRzL0FhbmJvZC5zdmMvJyArIG9iamVjdFR5cGUgKyAnLycgKyBhcGlLZXkgKyAnLz90eXBlPScgKyB0eXBlICsgJyZ6bz0vJyArIGNpdHkgKyAnJnBhZ2U9JyArIHBhZ2VOdW1iZXIgKyAnJnBhZ2VzaXplPScgKyBwYWdlU2l6ZSArICcnO1xuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoYXBpVVJMKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgdmFyIGhvdXNlSURzID0gW107XG5cbiAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChob3VzZURhdGEuT2JqZWN0cywgZnVuY3Rpb24gKGhvdXNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhvdXNlLkhlZWZ0VmlkZW8gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgSURzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGhvdXNlLklkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGhvdXNlSURzLnB1c2goSURzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coaG91c2VJRHMpO1xuICAgICAgICAgICAgQVBQLnJvdXRlci5pbml0KGhvdXNlSURzLCBjaXR5KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlRmF2b3VyaXRlcyhjaXR5KSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIHR5cGUgPSAna29vcCcsXG4gICAgICAgICAgICBjaXR5ID0gY2l0eSxcbiAgICAgICAgICAgIHBhZ2VOdW1iZXIgPSAnMScsXG4gICAgICAgICAgICBwYWdlU2l6ZSA9ICcyNScsXG4gICAgICAgICAgICBhcGlVUkwgPSAnaHR0cDovL2Z1bmRhLmt5cmFuZGlhLm5sL2ZlZWRzL0FhbmJvZC5zdmMvJyArIG9iamVjdFR5cGUgKyAnLycgKyBhcGlLZXkgKyAnLz90eXBlPScgKyB0eXBlICsgJyZ6bz0vJyArIGNpdHkgKyAnJnBhZ2U9JyArIHBhZ2VOdW1iZXIgKyAnJnBhZ2VzaXplPScgKyBwYWdlU2l6ZSArICcnO1xuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoYXBpVVJMKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhob3VzZURhdGEpO1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuXG4gICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwoaG91c2VEYXRhLk9iamVjdHMsIGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IG9iamVjdC5JZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iamVjdC5BZHJlcyxcbiAgICAgICAgICAgICAgICAgICAgcGhvdG86IG9iamVjdC5Gb3RvTGFyZ2VzdCxcbiAgICAgICAgICAgICAgICAgICAgcG9zdGFsY29kZTogb2JqZWN0LlBvc3Rjb2RlLFxuICAgICAgICAgICAgICAgICAgICBwbGFjZTogb2JqZWN0Lldvb25wbGFhdHMsXG4gICAgICAgICAgICAgICAgICAgIHByaWNlOiBvYmplY3QuUHJpanMuS29vcHByaWpzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqZWN0cyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgICAgIEFQUC5wYWdlLmhvdXNlRmF2b3VyaXRlcyhkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlRGV0YWlsKElEKSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIElEID0gSUQsXG4gICAgICAgICAgICB0eXBlID0gJ2tvb3AnLFxuICAgICAgICAgICAgYXBpVVJMID0gJ2h0dHA6Ly9mdW5kYS5reXJhbmRpYS5ubC9mZWVkcy9BYW5ib2Quc3ZjLycgKyBvYmplY3RUeXBlICsgJy9kZXRhaWwvJyArIGFwaUtleSArICcvJyArIHR5cGUgKyAnLycgKyBJRCArICcvJztcblxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KGFwaVVSTCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBob3VzZURhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coaG91c2VEYXRhKTtcblxuICAgICAgICAgICAgdmFyIGksIG1lZGlhLCBqLCBtZWRpYUl0ZW1zLCBsYXJnZVBob3Rvc1VybDtcbiAgICAgICAgICAgIHZhciBwaG90b3MgPSBbXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBob3VzZURhdGEuTWVkaWEubGVuZ3RoIC0gMTI7IGkrKykge1xuICAgICAgICAgICAgICAgIG1lZGlhID0gaG91c2VEYXRhLk1lZGlhW2ldO1xuICAgICAgICAgICAgICAgIGlmIChtZWRpYS5NZWRpYUl0ZW1zWzNdICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsYXJnZVBob3Rvc1VybCA9IG1lZGlhLk1lZGlhSXRlbXNbM10uVXJsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsYXJnZVBob3Rvc1VybCk7XG4gICAgICAgICAgICAgICAgcGhvdG9zLnB1c2goeyBwaG90bzogbGFyZ2VQaG90b3NVcmwgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBob3Rvcyk7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuXG4gICAgICAgICAgICB2YXIgb2JqZWN0cyA9IHtcbiAgICAgICAgICAgICAgICBpZDogaG91c2VEYXRhLkludGVybmFsSWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGhvdXNlRGF0YS5UaXRlbHNbMF0uT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgIHBob3RvczogcGhvdG9zLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBob3VzZURhdGEuVm9sbGVkaWdlT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgIHByaWNlOiBob3VzZURhdGEuS29vcFByaWpzLFxuICAgICAgICAgICAgICAgIHVybDogaG91c2VEYXRhLlVSTFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGRhdGEucHVzaChvYmplY3RzKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgICAgIEFQUC5wYWdlLmhvdXNlRGV0YWlsKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0SG91c2VWaWRlbyhJRCwgaG91c2VJRHMpIHtcbiAgICAgICAgdmFyIG9iamVjdFR5cGUgPSAnanNvbicsXG4gICAgICAgICAgICBhcGlLZXkgPSAnZTJkNjBlODg1Yjg3NDJkNGIwNjQ4MzAwZTM3MDNiZDcnLFxuICAgICAgICAgICAgSUQgPSBJRCxcbiAgICAgICAgICAgIHR5cGUgPSAna29vcCcsXG4gICAgICAgICAgICBhcGlVUkwgPSAnaHR0cDovL2Z1bmRhLmt5cmFuZGlhLm5sL2ZlZWRzL0FhbmJvZC5zdmMvJyArIG9iamVjdFR5cGUgKyAnL2RldGFpbC8nICsgYXBpS2V5ICsgJy8nICsgdHlwZSArICcvJyArIElEICsgJy8nO1xuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoYXBpVVJMKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGhvdXNlRGV0YWlsRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAvLyBHZXQgbmV4dCBJRCBpbiBhcnJheVxuICAgICAgICAgICAgdmFyIG5leHRJdGVtID0gZnVuY3Rpb24gbmV4dEl0ZW0oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgIG1heCA9IGhvdXNlSURzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIGZvciAoaTsgaSA8IG1heDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChob3VzZUlEc1tpXS5pZCA9PT0gSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBob3VzZUlEc1tpICsgMV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICdub3QgZm91bmQnO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gR2V0IHByZXYgSUQgaW4gYXJyYXlcbiAgICAgICAgICAgIHZhciBwcmV2SXRlbSA9IGZ1bmN0aW9uIHByZXZJdGVtKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICBtYXggPSBob3VzZUlEcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGk7IGkgPCBtYXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaG91c2VJRHNbaV0uaWQgPT09IElEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaG91c2VJRHNbaSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAnbm90IGZvdW5kJztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBuZXh0SUQgPSBuZXh0SXRlbShJRCk7XG4gICAgICAgICAgICB2YXIgcHJldklEID0gcHJldkl0ZW0oSUQpO1xuXG4gICAgICAgICAgICBpZiAocHJldklEID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogSUQsXG4gICAgICAgICAgICAgICAgICAgIG5leHRJRDogbmV4dElELmlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEZXRhaWxEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgICAgIGJ1eVByaWNlOiBob3VzZURldGFpbERhdGEuUHJpanMuS29vcHByaWpzLFxuICAgICAgICAgICAgICAgICAgICB2aWRlb1VSTDogaG91c2VEZXRhaWxEYXRhLlZpZGVvLlZpZGVvc1swXS5DZG5zWzBdLlVybFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5leHRJRCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IElELFxuICAgICAgICAgICAgICAgICAgICBwcmV2SUQ6IHByZXZJRC5pZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGhvdXNlRGV0YWlsRGF0YS5UaXRlbHNbMF0uT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgICAgICBidXlQcmljZTogaG91c2VEZXRhaWxEYXRhLlByaWpzLktvb3BwcmlqcyxcbiAgICAgICAgICAgICAgICAgICAgdmlkZW9VUkw6IGhvdXNlRGV0YWlsRGF0YS5WaWRlby5WaWRlb3NbMF0uQ2Ruc1swXS5VcmxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IElELFxuICAgICAgICAgICAgICAgICAgICBuZXh0SUQ6IG5leHRJRC5pZCxcbiAgICAgICAgICAgICAgICAgICAgcHJldklEOiBwcmV2SUQuaWQsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBob3VzZURldGFpbERhdGEuVGl0ZWxzWzBdLk9tc2NocmlqdmluZyxcbiAgICAgICAgICAgICAgICAgICAgYnV5UHJpY2U6IGhvdXNlRGV0YWlsRGF0YS5Qcmlqcy5Lb29wcHJpanMsXG4gICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMOiBob3VzZURldGFpbERhdGEuVmlkZW8uVmlkZW9zWzBdLkNkbnNbMF0uVXJsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICBBUFAucGFnZS5ob3VzZVZpZGVvKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIF9kZWZpbmVQcm9wZXJ0eSh7XG4gICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsXG4gICAgICAgIGdldEhvdXNlczogZ2V0SG91c2VzLFxuICAgICAgICBnZXRIb3VzZUZhdm91cml0ZXM6IGdldEhvdXNlRmF2b3VyaXRlcyxcbiAgICAgICAgZ2V0SG91c2VWaWRlbzogZ2V0SG91c2VWaWRlbyxcbiAgICAgICAgZ2V0SG91c2VEZXRhaWw6IGdldEhvdXNlRGV0YWlsIH0sICdnZXRIb3VzZURldGFpbCcsIGdldEhvdXNlRGV0YWlsKTtcbn0oKTtcbid1c2Ugc3RyaWN0JztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRHRU8gTE9DQVRJT05cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5nZW8gPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gZ2V0TG9jYXRpb24oKSB7XG4gICAgICAgIGlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcbiAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oZGlzcGxheVBvc2l0aW9uLCBkaXNwbGF5RXJyb3IsIHtcbiAgICAgICAgICAgICAgICBlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsXG4gICAgICAgICAgICAgICAgbWF4aW11bUFnZTogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5UG9zaXRpb24ocG9zaXRpb24pIHtcbiAgICAgICAgdmFyIGdwc1RvQ2l0eSA9IFsnaHR0cDovL25vbWluYXRpbS5vcGVuc3RyZWV0bWFwLm9yZy9yZXZlcnNlP2Zvcm1hdD1qc29uJmxhdD0nLCAnJmxvbj0nXSxcbiAgICAgICAgICAgIGxhdCA9IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcbiAgICAgICAgICAgIGxvbiA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUsXG4gICAgICAgICAgICB6b29tID0gJyZ6b29tPTEzJmFkZHJlc3NkZXRhaWxzPTEnLFxuICAgICAgICAgICAgQ2l0eVVybCA9IGdwc1RvQ2l0eVswXSArIGxhdCArIGdwc1RvQ2l0eVsxXSArIGxvbiArIHpvb207XG5cbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdChDaXR5VXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGNpdHlEYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICAgICAgICB2YXIgY2l0eSA9IGNpdHlEYXRhLmFkZHJlc3MuY2l0eSB8fCBjaXR5RGF0YS5hZGRyZXNzLnRvd247XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnTG9jYXRpb24nLCBjaXR5KTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coY2l0eSk7XG5cbiAgICAgICAgICAgIEFQUC5kYXRhLmdldEhvdXNlcyhjaXR5KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheUVycm9yKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnYW4gZXJyb3IgaGFzIG9jY3VyZWQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXRMb2NhdGlvbjogZ2V0TG9jYXRpb24sXG4gICAgICAgIGRpc3BsYXlQb3NpdGlvbjogZGlzcGxheVBvc2l0aW9uXG4gICAgfTtcbn0oKTtcbid1c2Ugc3RyaWN0JztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRQQUdFUyBbd2l0aCB0ZW1wbGF0aW5nIGxpYjogTXVzdGFjaGVdXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAucGFnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX21haW5TZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKTtcbiAgICB2YXIgX2xvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkZXInKTtcblxuICAgIGZ1bmN0aW9uIGhvdXNlVmlkZW8oZGF0YSkge1xuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KCcuL2Rpc3QvdGVtcGxhdGVzL2hvdXNlLXZpZGVvcy5tc3QnKS50aGVuKGZ1bmN0aW9uICh0ZW1wbGF0ZSkge1xuICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgX2xvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgQVBQLnN0b3JhZ2UuaW5pdCgpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaG91c2VEZXRhaWwoZGF0YSkge1xuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KCcuL2Rpc3QvdGVtcGxhdGVzL2hvdXNlLWRldGFpbC5tc3QnKS50aGVuKGZ1bmN0aW9uICh0ZW1wbGF0ZSkge1xuICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgX2xvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGhvdXNlRmF2b3VyaXRlcyhkYXRhKSB7XG5cbiAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiaG91c2VJRFwiKSAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgSURzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hvdXNlSUQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBJRHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIEZpbHRlciBJRCAqL1xuICAgICAgICB2YXIgZGF0YSA9IGRhdGEuZmlsdGVyKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gSURzLmluZGV4T2YoYy5pZCkgIT0gLTE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4vZGlzdC90ZW1wbGF0ZXMvaG91c2UtZmF2b3VyaXRlcy5tc3QnKS50aGVuKGZ1bmN0aW9uICh0ZW1wbGF0ZSkge1xuICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgX2xvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgQVBQLnN0b3JhZ2UuaW5pdCgpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaG91c2VWaWRlbzogaG91c2VWaWRlbyxcbiAgICAgICAgaG91c2VEZXRhaWw6IGhvdXNlRGV0YWlsLFxuICAgICAgICBob3VzZUZhdm91cml0ZXM6IGhvdXNlRmF2b3VyaXRlc1xuICAgIH07XG59KCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0Uk9VVEVSIE1PRFVMRSBbd2l0aCByb3V0ZXIgbGliOiBSb3V0aWVdXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAucm91dGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGluaXQoaG91c2VJRHMsIGNpdHkpIHtcbiAgICAgICAgaWYgKCF3aW5kb3cubG9jYXRpb24uaGFzaCkge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJyN2aWRlb0lEPScgKyBob3VzZUlEc1swXS5pZDtcbiAgICAgICAgfVxuICAgICAgICByb3V0aWUoe1xuICAgICAgICAgICAgJ3ZpZGVvSUQ9OklEJzogZnVuY3Rpb24gdmlkZW9JRElEKElEKSB7XG4gICAgICAgICAgICAgICAgQVBQLmRhdGEuZ2V0SG91c2VWaWRlbyhJRCwgaG91c2VJRHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdob3VzZURldGFpbD06SUQnOiBmdW5jdGlvbiBob3VzZURldGFpbElEKElEKSB7XG4gICAgICAgICAgICAgICAgQVBQLmRhdGEuZ2V0SG91c2VEZXRhaWwoSUQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdmYXZvdXJpdGVzJzogZnVuY3Rpb24gZmF2b3VyaXRlcygpIHtcbiAgICAgICAgICAgICAgICBBUFAuZGF0YS5nZXRIb3VzZUZhdm91cml0ZXMoY2l0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0oKTtcblwidXNlIHN0cmljdFwiO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxuQVBQLnN0b3JhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdGZ1bmN0aW9uIGluaXQoKSB7XG5cdFx0Ly8gc3JjOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwMDA4MTE0L2hvdy1kby1pLXByb21pc2lmeS1uYXRpdmUteGhyXG5cdFx0LyogTG9jYWwgU3RvcmFnZSBhcnJheSAgKi9cblx0XHRpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJob3VzZUlEXCIpID09PSBudWxsIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiaG91c2VJRFwiKSA9PT0gXCJcIikge1xuXHRcdFx0dmFyIGFycmF5SUQgPSBbXTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmFyIGFycmF5SUQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdob3VzZUlEJykpO1xuXHRcdH1cblxuXHRcdC8vIENyZWF0ZSBhIG5ldyB2YXJpYWJsZSBuZXdBcnJheUlEIGZvciBkeW5hbWljIGFkZGluZyBmYXZvdXJpdGVzLlxuXHRcdHZhciBuZXdBcnJheUlEID0gYXJyYXlJRDtcblxuXHRcdC8vIEZpbmQgYnV0dG9uXG5cdFx0dmFyIF9mYXZvdXJpdGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmF2b3VyaXRlLWJ0bicpO1xuXG5cdFx0Ly8gQ2hlY2sgaWYgSUQgaXMgc3RvcmVkIGluIGFycmF5IGFuZCBtYWtlIGJ1dHRvbiBhY3RpdmVcblx0XHRbXS5mb3JFYWNoLmNhbGwobmV3QXJyYXlJRCwgZnVuY3Rpb24gKElEKSB7XG5cdFx0XHR2YXIgX2Zhdm91cml0ZUJ1dHRvbklEID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZhdm91cml0ZS1idG5bdmFsdWU9XCInICsgSUQgKyAnXCJdJyk7XG5cdFx0XHRpZiAoX2Zhdm91cml0ZUJ1dHRvbklEKSB7XG5cdFx0XHRcdF9mYXZvdXJpdGVCdXR0b25JRC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIEZhdm91cml0ZSBidXR0b24gZXZlbnRsaXN0ZW5lclxuXHRcdFtdLmZvckVhY2guY2FsbChfZmF2b3VyaXRlQnV0dG9uLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG5cdFx0XHQvL3ZhciBidXR0b25JRCA9IGJ1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcblx0XHRcdGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN0b3JlSUQsIGZhbHNlKTtcblx0XHR9KTtcblxuXHRcdGZ1bmN0aW9uIHN0b3JlSUQoZXZlbnQpIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR2YXIgY2xpY2tlZElEID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyk7XG5cdFx0XHRhcnJheUlELnB1c2goY2xpY2tlZElEKTtcblxuXHRcdFx0Ly8gUmVtb3ZlIGNsYXNzXG5cdFx0XHR0aGlzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXG5cdFx0XHQvKiAgQ0hFQ0sgRk9SIERVUExJQ0FURUQgSUQncyAtIHNyYzogaHR0cHM6Ly9qc2ZpZGRsZS5uZXQvQnVtYmxlQjJuYS9YdmdUYi8xLyAqL1xuXHRcdFx0Zm9yICh2YXIgaCA9IDA7IGggPCBuZXdBcnJheUlELmxlbmd0aDsgaCsrKSB7XG5cdFx0XHRcdHZhciBjdXJJdGVtID0gbmV3QXJyYXlJRFtoXSxcblx0XHRcdFx0ICAgIGZvdW5kQ291bnQgPSAwO1xuXHRcdFx0XHQvLyBzZWFyY2ggYXJyYXkgZm9yIGl0ZW1cblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBuZXdBcnJheUlELmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKG5ld0FycmF5SURbaV0gPT0gYXJyYXlJRFtoXSkgZm91bmRDb3VudCsrO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChmb3VuZENvdW50ID4gMSkge1xuXHRcdFx0XHRcdC8vIHJlbW92ZSByZXBlYXRlZCBpdGVtIGZyb20gbmV3IGFycmF5XG5cdFx0XHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBuZXdBcnJheUlELmxlbmd0aDsgaisrKSB7XG5cdFx0XHRcdFx0XHRpZiAobmV3QXJyYXlJRFtqXSA9PSBjdXJJdGVtKSB7XG5cdFx0XHRcdFx0XHRcdG5ld0FycmF5SUQuc3BsaWNlKGosIDEpO1xuXHRcdFx0XHRcdFx0XHRqID0gaiAtIDE7XG5cdFx0XHRcdFx0XHRcdC8vdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblx0XHRcdFx0XHRcdFx0Ly90aGlzLmlubmVySFRNTCA9ICdBZGQgdG8gZmF2b3VyaXRlcyc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHQvLyBDaGVjayBpZiBJRCBpcyBzdG9yZWQgaW4gYXJyYXkgYW5kIG1ha2UgYnV0dG9uIGFjdGl2ZVxuXHRcdFx0W10uZm9yRWFjaC5jYWxsKG5ld0FycmF5SUQsIGZ1bmN0aW9uIChJRCkge1xuXHRcdFx0XHR2YXIgX2Zhdm91cml0ZUJ1dHRvbklEID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZhdm91cml0ZS1idG5bdmFsdWU9XCInICsgSUQgKyAnXCJdJyk7XG5cdFx0XHRcdGlmIChfZmF2b3VyaXRlQnV0dG9uSUQpIHtcblx0XHRcdFx0XHRfZmF2b3VyaXRlQnV0dG9uSUQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRhZGRTdG9yYWdlKCdob3VzZUlEJywgbmV3QXJyYXlJRCk7XG5cdFx0fTtcblxuXHRcdGZ1bmN0aW9uIGFkZFN0b3JhZ2Uoa2V5LCB2YWx1ZSkge1xuXHRcdFx0Ly8gc3JjOiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9GbHVpZGJ5dGUvNDcxODM4MFxuXHRcdFx0dmFyIGxzU3VwcG9ydDtcblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0bG9jYWxTdG9yYWdlLnRlc3QgPSAxO1xuXHRcdFx0XHRsc1N1cHBvcnQgPSB0cnVlO1xuXHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHRsc1N1cHBvcnQgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgdmFsdWUgaXMgZGV0ZWN0ZWQsIHNldCBuZXcgb3IgbW9kaWZ5IHN0b3JlXG5cdFx0XHRpZiAodHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbHVlICE9PSBudWxsKSB7XG5cdFx0XHRcdC8vIENvbnZlcnQgb2JqZWN0IHZhbHVlcyB0byBKU09OXG5cdFx0XHRcdGlmICgodHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YodmFsdWUpKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdFx0XHR2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBTZXQgdGhlIHN0b3JlXG5cdFx0XHRcdGlmIChsc1N1cHBvcnQpIHtcblx0XHRcdFx0XHQvLyBOYXRpdmUgc3VwcG9ydFxuXHRcdFx0XHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIFVzZSBDb29raWVcblx0XHRcdFx0XHRjcmVhdGVDb29raWUoa2V5LCB2YWx1ZSwgMzApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5vIHZhbHVlIHN1cHBsaWVkLCByZXR1cm4gdmFsdWVcblx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0Ly8gR2V0IHZhbHVlXG5cdFx0XHRcdGlmIChsc1N1cHBvcnQpIHtcblx0XHRcdFx0XHQvLyBOYXRpdmUgc3VwcG9ydFxuXHRcdFx0XHRcdGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIFVzZSBjb29raWVcblx0XHRcdFx0XHRkYXRhID0gcmVhZENvb2tpZShrZXkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gVHJ5IHRvIHBhcnNlIEpTT04uLi5cblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcblx0XHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHRcdGRhdGEgPSBkYXRhO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGRhdGE7XG5cdFx0XHR9XG5cblx0XHRcdC8vIE51bGwgc3BlY2lmaWVkLCByZW1vdmUgc3RvcmVcblx0XHRcdGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRpZiAobHNTdXBwb3J0KSB7XG5cdFx0XHRcdFx0Ly8gTmF0aXZlIHN1cHBvcnRcblx0XHRcdFx0XHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIFVzZSBjb29raWVcblx0XHRcdFx0XHRjcmVhdGVDb29raWUoa2V5LCAnJywgLTEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuICAgICogQ3JlYXRlcyBuZXcgY29va2llIG9yIHJlbW92ZXMgY29va2llIHdpdGggbmVnYXRpdmUgZXhwaXJhdGlvblxuICAgICogQHBhcmFtICBrZXkgICAgICAgVGhlIGtleSBvciBpZGVudGlmaWVyIGZvciB0aGUgc3RvcmVcbiAgICAqIEBwYXJhbSAgdmFsdWUgICAgIENvbnRlbnRzIG9mIHRoZSBzdG9yZVxuICAgICogQHBhcmFtICBleHAgICAgICAgRXhwaXJhdGlvbiAtIGNyZWF0aW9uIGRlZmF1bHRzIHRvIDMwIGRheXNcbiAgICAqL1xuXHRcdFx0ZnVuY3Rpb24gY3JlYXRlQ29va2llKGtleSwgdmFsdWUsIGV4cCkge1xuXHRcdFx0XHR2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG5cdFx0XHRcdGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIGV4cCAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuXHRcdFx0XHR2YXIgZXhwaXJlcyA9IFwiOyBleHBpcmVzPVwiICsgZGF0ZS50b0dNVFN0cmluZygpO1xuXHRcdFx0XHRkb2N1bWVudC5jb29raWUgPSBrZXkgKyBcIj1cIiArIHZhbHVlICsgZXhwaXJlcyArIFwiOyBwYXRoPS9cIjtcblx0XHRcdH1cblxuXHRcdFx0LyoqXG4gICAgKiBSZXR1cm5zIGNvbnRlbnRzIG9mIGNvb2tpZVxuICAgICogQHBhcmFtICBrZXkgICAgICAgVGhlIGtleSBvciBpZGVudGlmaWVyIGZvciB0aGUgc3RvcmVcbiAgICAqL1xuXHRcdFx0ZnVuY3Rpb24gcmVhZENvb2tpZShrZXkpIHtcblx0XHRcdFx0dmFyIG5hbWVFUSA9IGtleSArIFwiPVwiO1xuXHRcdFx0XHR2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIG1heCA9IGNhLmxlbmd0aDsgaSA8IG1heDsgaSsrKSB7XG5cdFx0XHRcdFx0dmFyIGMgPSBjYVtpXTtcblx0XHRcdFx0XHR3aGlsZSAoYy5jaGFyQXQoMCkgPT09ICcgJykge1xuXHRcdFx0XHRcdFx0YyA9IGMuc3Vic3RyaW5nKDEsIGMubGVuZ3RoKTtcblx0XHRcdFx0XHR9aWYgKGMuaW5kZXhPZihuYW1lRVEpID09PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH07XG5cdH07XG5cblx0cmV0dXJuIHtcblx0XHRpbml0OiBpbml0XG5cdH07XG59KCk7IiwiXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdE5BTUVTUEFDRVxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xudmFyIEFQUCA9IEFQUCB8fCB7fTtcbid1c2Ugc3RyaWN0JztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgIExBVU5DSCBBUFBcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5sYXVuY2hlciA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBBUFAuZ2VvLmdldExvY2F0aW9uKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcblxufSgpKTtcblxuQVBQLmxhdW5jaGVyLmluaXQoKTtcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0REFUQSBSRVFVRVNUXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAuZGF0YSA9IChmdW5jdGlvbiAoY2l0eSkge1xuICAgIGZ1bmN0aW9uIHJlcXVlc3QodXJsKSB7IC8vIHNyYzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAwODExNC9ob3ctZG8taS1wcm9taXNpZnktbmF0aXZlLXhoclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA+PSAyMDAgJiYgdGhpcy5zdGF0dXMgPCAzMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRoaXMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGhpcy5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHhoci5zdGF0dXNUZXh0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeGhyLnNlbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlcyhjaXR5KSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIHR5cGUgPSAna29vcCcsXG4gICAgICAgICAgICBjaXR5ID0gY2l0eSxcbiAgICAgICAgICAgIHBhZ2VOdW1iZXIgPSAnMScsXG4gICAgICAgICAgICBwYWdlU2l6ZSA9ICcyNScsXG4gICAgICAgICAgICBhcGlVUkwgPSAnaHR0cDovL2Z1bmRhLmt5cmFuZGlhLm5sL2ZlZWRzL0FhbmJvZC5zdmMvJysgb2JqZWN0VHlwZSArICcvJysgYXBpS2V5ICsgJy8/dHlwZT0nICsgdHlwZSArICcmem89LycgKyBjaXR5ICsgJyZwYWdlPScgKyBwYWdlTnVtYmVyICsgJyZwYWdlc2l6ZT0nICsgcGFnZVNpemUgKyAnJztcblxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KGFwaVVSTClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBob3VzZURhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB2YXIgaG91c2VJRHMgPSBbXTtcblxuICAgICAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChob3VzZURhdGEuT2JqZWN0cywgZnVuY3Rpb24gKGhvdXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGhvdXNlLkhlZWZ0VmlkZW8gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIElEcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaG91c2UuSWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBob3VzZUlEcy5wdXNoKElEcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGhvdXNlSURzKTtcbiAgICAgICAgICAgICAgICBBUFAucm91dGVyLmluaXQoaG91c2VJRHMsIGNpdHkpO1xuICAgICAgICAgICAgfSlcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0SG91c2VGYXZvdXJpdGVzKGNpdHkpIHtcbiAgICAgICAgdmFyIG9iamVjdFR5cGUgPSAnanNvbicsXG4gICAgICAgICAgICBhcGlLZXkgPSAnZTJkNjBlODg1Yjg3NDJkNGIwNjQ4MzAwZTM3MDNiZDcnLFxuICAgICAgICAgICAgdHlwZSA9ICdrb29wJyxcbiAgICAgICAgICAgIGNpdHkgPSBjaXR5LFxuICAgICAgICAgICAgcGFnZU51bWJlciA9ICcxJyxcbiAgICAgICAgICAgIHBhZ2VTaXplID0gJzI1JyxcbiAgICAgICAgICAgIGFwaVVSTCA9ICdodHRwOi8vZnVuZGEua3lyYW5kaWEubmwvZmVlZHMvQWFuYm9kLnN2Yy8nKyBvYmplY3RUeXBlICsgJy8nKyBhcGlLZXkgKyAnLz90eXBlPScgKyB0eXBlICsgJyZ6bz0vJyArIGNpdHkgKyAnJnBhZ2U9JyArIHBhZ2VOdW1iZXIgKyAnJnBhZ2VzaXplPScgKyBwYWdlU2l6ZSArICcnO1xuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoYXBpVVJMKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaG91c2VEYXRhKTtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gW107XG5cbiAgICAgICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwoaG91c2VEYXRhLk9iamVjdHMsIGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogb2JqZWN0LklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iamVjdC5BZHJlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvOiBvYmplY3QuRm90b0xhcmdlc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0YWxjb2RlOiBvYmplY3QuUG9zdGNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGFjZTogb2JqZWN0Lldvb25wbGFhdHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogb2JqZWN0LlByaWpzLktvb3Bwcmlqc1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqZWN0cyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAgIEFQUC5wYWdlLmhvdXNlRmF2b3VyaXRlcyhkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlRGV0YWlsKElEKSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIElEID0gSUQsXG4gICAgICAgICAgICB0eXBlID0gJ2tvb3AnLFxuICAgICAgICAgICAgYXBpVVJMID0gJ2h0dHA6Ly9mdW5kYS5reXJhbmRpYS5ubC9mZWVkcy9BYW5ib2Quc3ZjLycgKyBvYmplY3RUeXBlICsgJy9kZXRhaWwvJyArIGFwaUtleSArICcvJyArIHR5cGUgKyAnLycgKyBJRCArICcvJztcblxuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoYXBpVVJMKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaG91c2VEYXRhKTtcblxuICAgICAgICAgICAgICAgIHZhciBpLCBtZWRpYSwgaiwgbWVkaWFJdGVtcywgbGFyZ2VQaG90b3NVcmw7XG4gICAgICAgICAgICAgICAgdmFyIHBob3RvcyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBob3VzZURhdGEuTWVkaWEubGVuZ3RoLTEyOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgIG1lZGlhID0gaG91c2VEYXRhLk1lZGlhW2ldO1xuICAgICAgICAgICAgICAgICAgaWYobWVkaWEuTWVkaWFJdGVtc1szXSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBsYXJnZVBob3Rvc1VybCA9IG1lZGlhLk1lZGlhSXRlbXNbM10uVXJsO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobGFyZ2VQaG90b3NVcmwpO1xuICAgICAgICAgICAgICAgICAgcGhvdG9zLnB1c2goe3Bob3RvOiBsYXJnZVBob3Rvc1VybH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBob3Rvcyk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcblxuICAgICAgICAgICAgICAgIHZhciBvYmplY3RzID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogaG91c2VEYXRhLkludGVybmFsSWQsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBob3VzZURhdGEuVGl0ZWxzWzBdLk9tc2NocmlqdmluZyxcbiAgICAgICAgICAgICAgICAgICAgcGhvdG9zOiBwaG90b3MsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBob3VzZURhdGEuVm9sbGVkaWdlT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgICAgICBwcmljZTogaG91c2VEYXRhLktvb3BQcmlqcyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBob3VzZURhdGEuVVJMXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqZWN0cyk7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAgIEFQUC5wYWdlLmhvdXNlRGV0YWlsKGRhdGEpO1xuICAgICAgICAgICAgfSlcblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBnZXRIb3VzZVZpZGVvKElELCBob3VzZUlEcykge1xuICAgICAgICB2YXIgb2JqZWN0VHlwZSA9ICdqc29uJyxcbiAgICAgICAgICAgIGFwaUtleSA9ICdlMmQ2MGU4ODViODc0MmQ0YjA2NDgzMDBlMzcwM2JkNycsXG4gICAgICAgICAgICBJRCA9IElELFxuICAgICAgICAgICAgdHlwZSA9ICdrb29wJyxcbiAgICAgICAgICAgIGFwaVVSTCA9ICdodHRwOi8vZnVuZGEua3lyYW5kaWEubmwvZmVlZHMvQWFuYm9kLnN2Yy8nICsgb2JqZWN0VHlwZSArICcvZGV0YWlsLycgKyBhcGlLZXkgKyAnLycgKyB0eXBlICsgJy8nICsgSUQgKyAnLyc7XG5cblxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KGFwaVVSTClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBob3VzZURldGFpbERhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgIC8vIEdldCBuZXh0IElEIGluIGFycmF5XG4gICAgICAgICAgICAgICAgdmFyIG5leHRJdGVtID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4ID0gaG91c2VJRHMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaTsgaSA8IG1heDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91c2VJRHNbaV0uaWQgPT09IElEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhvdXNlSURzW2kgKyAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ25vdCBmb3VuZCc7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIEdldCBwcmV2IElEIGluIGFycmF5XG4gICAgICAgICAgICAgICAgdmFyIHByZXZJdGVtID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4ID0gaG91c2VJRHMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvcihpOyBpIDwgbWF4OyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3VzZUlEc1tpXS5pZCA9PT0gSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaG91c2VJRHNbaSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbm90IGZvdW5kJztcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIG5leHRJRCA9IG5leHRJdGVtKElEKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJldklEID0gcHJldkl0ZW0oSUQpO1xuXG4gICAgICAgICAgICAgICAgaWYocHJldklEID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJRDogbmV4dElELmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGhvdXNlRGV0YWlsRGF0YS5UaXRlbHNbMF0uT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgYnV5UHJpY2U6IGhvdXNlRGV0YWlsRGF0YS5Qcmlqcy5Lb29wcHJpanMsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlb1VSTDogaG91c2VEZXRhaWxEYXRhLlZpZGVvLlZpZGVvc1swXS5DZG5zWzBdLlVybFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuZXh0SUQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IElELFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJldklEOiBwcmV2SUQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEZXRhaWxEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBidXlQcmljZTogaG91c2VEZXRhaWxEYXRhLlByaWpzLktvb3BwcmlqcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMOiBob3VzZURldGFpbERhdGEuVmlkZW8uVmlkZW9zWzBdLkNkbnNbMF0uVXJsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogSUQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0SUQ6IG5leHRJRC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZJRDogcHJldklELmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGhvdXNlRGV0YWlsRGF0YS5UaXRlbHNbMF0uT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgYnV5UHJpY2U6IGhvdXNlRGV0YWlsRGF0YS5Qcmlqcy5Lb29wcHJpanMsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlb1VSTDogaG91c2VEZXRhaWxEYXRhLlZpZGVvLlZpZGVvc1swXS5DZG5zWzBdLlVybFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgICAgIEFQUC5wYWdlLmhvdXNlVmlkZW8oZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LFxuICAgICAgICBnZXRIb3VzZXM6IGdldEhvdXNlcyxcbiAgICAgICAgZ2V0SG91c2VGYXZvdXJpdGVzOiBnZXRIb3VzZUZhdm91cml0ZXMsXG4gICAgICAgIGdldEhvdXNlVmlkZW86IGdldEhvdXNlVmlkZW8sXG4gICAgICAgIGdldEhvdXNlRGV0YWlsLCBnZXRIb3VzZURldGFpbFxuICAgIH07XG5cbn0pKCk7XG4iLCIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdEdFTyBMT0NBVElPTlxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuQVBQLmdlbyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gZ2V0TG9jYXRpb24oKSB7XG4gICAgICAgIGlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcbiAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oXG4gICAgICAgICAgICAgICAgZGlzcGxheVBvc2l0aW9uLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlFcnJvciwge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1heGltdW1BZ2U6IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheVBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBncHNUb0NpdHkgPSBbJ2h0dHA6Ly9ub21pbmF0aW0ub3BlbnN0cmVldG1hcC5vcmcvcmV2ZXJzZT9mb3JtYXQ9anNvbiZsYXQ9JywgJyZsb249J10sXG4gICAgICAgICAgICBsYXQgPSBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXG4gICAgICAgICAgICBsb24gPSBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlLFxuICAgICAgICAgICAgem9vbSA9ICcmem9vbT0xMyZhZGRyZXNzZGV0YWlscz0xJyxcbiAgICAgICAgICAgIENpdHlVcmwgPSBncHNUb0NpdHlbMF0gKyBsYXQgKyBncHNUb0NpdHlbMV0gKyBsb24gKyB6b29tO1xuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoQ2l0eVVybClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBjaXR5RGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHZhciBjaXR5ID0gY2l0eURhdGEuYWRkcmVzcy5jaXR5IHx8IGNpdHlEYXRhLmFkZHJlc3MudG93bjtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnTG9jYXRpb24nLCBjaXR5KVxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2l0eSk7XG5cbiAgICAgICAgICAgICAgICBBUFAuZGF0YS5nZXRIb3VzZXMoY2l0eSk7XG4gICAgICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpc3BsYXlFcnJvcigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2FuIGVycm9yIGhhcyBvY2N1cmVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0TG9jYXRpb246IGdldExvY2F0aW9uLFxuICAgICAgICBkaXNwbGF5UG9zaXRpb246IGRpc3BsYXlQb3NpdGlvblxuICAgIH07XG5cbn0pKCk7XG4iLCIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFBBR0VTIFt3aXRoIHRlbXBsYXRpbmcgbGliOiBNdXN0YWNoZV1cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5wYWdlID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX21haW5TZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKTtcbiAgICB2YXIgX2xvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkZXInKTtcblxuICAgIGZ1bmN0aW9uIGhvdXNlVmlkZW8oZGF0YSkge1xuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KCcuL2Rpc3QvdGVtcGxhdGVzL2hvdXNlLXZpZGVvcy5tc3QnKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgICAgIF9sb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICBBUFAuc3RvcmFnZS5pbml0KCk7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBob3VzZURldGFpbChkYXRhKSB7XG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4vZGlzdC90ZW1wbGF0ZXMvaG91c2UtZGV0YWlsLm1zdCcpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodGVtcGxhdGUpIHtcbiAgICAgICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgX2xvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH0pXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGhvdXNlRmF2b3VyaXRlcyhkYXRhKSB7XG5cbiAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiaG91c2VJRFwiKSAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgSURzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hvdXNlSUQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBJRHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIEZpbHRlciBJRCAqL1xuICAgICAgICB2YXIgZGF0YSA9IGRhdGEuZmlsdGVyKGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgIHJldHVybiBJRHMuaW5kZXhPZihjLmlkKSAhPSAtMVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuXG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4vZGlzdC90ZW1wbGF0ZXMvaG91c2UtZmF2b3VyaXRlcy5tc3QnKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgICAgIF9sb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICBBUFAuc3RvcmFnZS5pbml0KCk7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBob3VzZVZpZGVvOiBob3VzZVZpZGVvLFxuICAgICAgICBob3VzZURldGFpbDogaG91c2VEZXRhaWwsXG4gICAgICAgIGhvdXNlRmF2b3VyaXRlczogaG91c2VGYXZvdXJpdGVzXG4gICAgfTtcblxufSkoKTtcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0Uk9VVEVSIE1PRFVMRSBbd2l0aCByb3V0ZXIgbGliOiBSb3V0aWVdXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAucm91dGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBpbml0IChob3VzZUlEcywgY2l0eSkge1xuICAgICAgICBpZiAoIXdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAnI3ZpZGVvSUQ9JyArIGhvdXNlSURzWzBdLmlkO1xuICAgICAgICB9XG4gICAgICAgIHJvdXRpZSh7XG4gICAgICAgICAgICAndmlkZW9JRD06SUQnOiBmdW5jdGlvbihJRCkge1xuICAgICAgICAgICAgICAgIEFQUC5kYXRhLmdldEhvdXNlVmlkZW8oSUQsIGhvdXNlSURzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnaG91c2VEZXRhaWw9OklEJzogZnVuY3Rpb24oSUQpIHtcbiAgICAgICAgICAgICAgICBBUFAuZGF0YS5nZXRIb3VzZURldGFpbChJRCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2Zhdm91cml0ZXMnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBBUFAuZGF0YS5nZXRIb3VzZUZhdm91cml0ZXMoY2l0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcblxufSkoKTtcbiIsIkFQUC5zdG9yYWdlID0gKGZ1bmN0aW9uICgpIHtcblx0ZnVuY3Rpb24gaW5pdCgpIHsgLy8gc3JjOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwMDA4MTE0L2hvdy1kby1pLXByb21pc2lmeS1uYXRpdmUteGhyXG5cdFx0LyogTG9jYWwgU3RvcmFnZSBhcnJheSAgKi9cblx0ICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImhvdXNlSURcIikgPT09IG51bGwgfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJob3VzZUlEXCIpID09PSBcIlwiKSB7XG5cdCAgICAgICAgdmFyIGFycmF5SUQgPSBbXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdmFyIGFycmF5SUQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdob3VzZUlEJykpO1xuXHQgICAgfVxuXG5cdFx0Ly8gQ3JlYXRlIGEgbmV3IHZhcmlhYmxlIG5ld0FycmF5SUQgZm9yIGR5bmFtaWMgYWRkaW5nIGZhdm91cml0ZXMuXG5cdCAgICB2YXIgbmV3QXJyYXlJRCA9IGFycmF5SUQ7XG5cblx0XHQvLyBGaW5kIGJ1dHRvblxuXHRcdHZhciBfZmF2b3VyaXRlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZhdm91cml0ZS1idG4nKTtcblxuXHRcdC8vIENoZWNrIGlmIElEIGlzIHN0b3JlZCBpbiBhcnJheSBhbmQgbWFrZSBidXR0b24gYWN0aXZlXG5cdFx0W10uZm9yRWFjaC5jYWxsKG5ld0FycmF5SUQsIGZ1bmN0aW9uKElEKSB7XG5cdFx0XHR2YXIgX2Zhdm91cml0ZUJ1dHRvbklEID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZhdm91cml0ZS1idG5bdmFsdWU9XCInICsgSUQgKyAnXCJdJyk7XG5cdFx0XHRpZihfZmF2b3VyaXRlQnV0dG9uSUQpIHtcblx0XHRcdFx0X2Zhdm91cml0ZUJ1dHRvbklELmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuXHRcdFx0fVxuXHQgXHR9KTtcblxuXHRcdC8vIEZhdm91cml0ZSBidXR0b24gZXZlbnRsaXN0ZW5lclxuXHRcdFtdLmZvckVhY2guY2FsbChfZmF2b3VyaXRlQnV0dG9uLCBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgICAgICAgIC8vdmFyIGJ1dHRvbklEID0gYnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RvcmVJRCwgZmFsc2UpO1xuICAgICAgICB9KTtcblxuXHRcdGZ1bmN0aW9uIHN0b3JlSUQoZXZlbnQpIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgIHZhciBjbGlja2VkSUQgPSB0aGlzLmdldEF0dHJpYnV0ZSgndmFsdWUnKTtcbiAgICAgICAgICAgIGFycmF5SUQucHVzaChjbGlja2VkSUQpO1xuXG5cdFx0XHQvLyBSZW1vdmUgY2xhc3Ncblx0XHRcdHRoaXMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cblx0XHRcdC8qICBDSEVDSyBGT1IgRFVQTElDQVRFRCBJRCdzIC0gc3JjOiBodHRwczovL2pzZmlkZGxlLm5ldC9CdW1ibGVCMm5hL1h2Z1RiLzEvICovXG4gICAgICAgICAgICBmb3IgKHZhciBoID0gMDsgaCA8IG5ld0FycmF5SUQubGVuZ3RoOyBoKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VySXRlbSA9IG5ld0FycmF5SURbaF0sXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIC8vIHNlYXJjaCBhcnJheSBmb3IgaXRlbVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV3QXJyYXlJRC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3QXJyYXlJRFtpXSA9PSBhcnJheUlEW2hdKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRDb3VudCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZm91bmRDb3VudCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHJlcGVhdGVkIGl0ZW0gZnJvbSBuZXcgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZXdBcnJheUlELmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3QXJyYXlJRFtqXSA9PSBjdXJJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3QXJyYXlJRC5zcGxpY2UoaiwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IGogLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMuaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvdXJpdGVzJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cblx0XHRcdC8vIENoZWNrIGlmIElEIGlzIHN0b3JlZCBpbiBhcnJheSBhbmQgbWFrZSBidXR0b24gYWN0aXZlXG5cdFx0XHRbXS5mb3JFYWNoLmNhbGwobmV3QXJyYXlJRCwgZnVuY3Rpb24oSUQpIHtcblx0XHRcdFx0dmFyIF9mYXZvdXJpdGVCdXR0b25JRCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mYXZvdXJpdGUtYnRuW3ZhbHVlPVwiJyArIElEICsgJ1wiXScpO1xuXHRcdFx0XHRpZihfZmF2b3VyaXRlQnV0dG9uSUQpIHtcblx0XHRcdFx0XHRfZmF2b3VyaXRlQnV0dG9uSUQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRhZGRTdG9yYWdlKCdob3VzZUlEJywgbmV3QXJyYXlJRCk7XG5cdFx0fTtcblxuXHRcdGZ1bmN0aW9uIGFkZFN0b3JhZ2Uoa2V5LCB2YWx1ZSkgeyAvLyBzcmM6IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL0ZsdWlkYnl0ZS80NzE4MzgwXG5cdCAgICAgICAgdmFyIGxzU3VwcG9ydDtcblxuXHQgICAgICAgIHRyeSB7XG5cdCAgICAgICAgICAgIGxvY2FsU3RvcmFnZS50ZXN0ID0gMTtcblx0ICAgICAgICAgICAgbHNTdXBwb3J0ID0gdHJ1ZTtcblx0ICAgICAgICB9IGNhdGNoIChlKSB7XG5cdCAgICAgICAgICAgIGxzU3VwcG9ydCA9IGZhbHNlO1xuXHQgICAgICAgIH1cblxuXHQgICAgICAgIC8vIElmIHZhbHVlIGlzIGRldGVjdGVkLCBzZXQgbmV3IG9yIG1vZGlmeSBzdG9yZVxuXHQgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIgJiYgdmFsdWUgIT09IG51bGwpIHtcblx0ICAgICAgICAgICAgLy8gQ29udmVydCBvYmplY3QgdmFsdWVzIHRvIEpTT05cblx0ICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcblx0ICAgICAgICAgICAgICAgIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIC8vIFNldCB0aGUgc3RvcmVcblx0ICAgICAgICAgICAgaWYgKGxzU3VwcG9ydCkgeyAvLyBOYXRpdmUgc3VwcG9ydFxuXHQgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XG5cdCAgICAgICAgICAgIH0gZWxzZSB7IC8vIFVzZSBDb29raWVcblx0ICAgICAgICAgICAgICAgIGNyZWF0ZUNvb2tpZShrZXksIHZhbHVlLCAzMCk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9XG5cblx0ICAgICAgICAvLyBObyB2YWx1ZSBzdXBwbGllZCwgcmV0dXJuIHZhbHVlXG5cdCAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHQgICAgICAgICAgICAvLyBHZXQgdmFsdWVcblx0ICAgICAgICAgICAgaWYgKGxzU3VwcG9ydCkgeyAvLyBOYXRpdmUgc3VwcG9ydFxuXHQgICAgICAgICAgICAgICAgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG5cdCAgICAgICAgICAgIH0gZWxzZSB7IC8vIFVzZSBjb29raWVcblx0ICAgICAgICAgICAgICAgIGRhdGEgPSByZWFkQ29va2llKGtleSk7XG5cdCAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgSlNPTi4uLlxuXHQgICAgICAgICAgICB0cnkge1xuXHQgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdCAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcblx0ICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhO1xuXHQgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cblx0ICAgICAgICB9XG5cblx0ICAgICAgICAvLyBOdWxsIHNwZWNpZmllZCwgcmVtb3ZlIHN0b3JlXG5cdCAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG5cdCAgICAgICAgICAgIGlmIChsc1N1cHBvcnQpIHsgLy8gTmF0aXZlIHN1cHBvcnRcblx0ICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG5cdCAgICAgICAgICAgIH0gZWxzZSB7IC8vIFVzZSBjb29raWVcblx0ICAgICAgICAgICAgICAgIGNyZWF0ZUNvb2tpZShrZXksICcnLCAtMSk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9XG5cblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBDcmVhdGVzIG5ldyBjb29raWUgb3IgcmVtb3ZlcyBjb29raWUgd2l0aCBuZWdhdGl2ZSBleHBpcmF0aW9uXG5cdCAgICAgICAgICogQHBhcmFtICBrZXkgICAgICAgVGhlIGtleSBvciBpZGVudGlmaWVyIGZvciB0aGUgc3RvcmVcblx0ICAgICAgICAgKiBAcGFyYW0gIHZhbHVlICAgICBDb250ZW50cyBvZiB0aGUgc3RvcmVcblx0ICAgICAgICAgKiBAcGFyYW0gIGV4cCAgICAgICBFeHBpcmF0aW9uIC0gY3JlYXRpb24gZGVmYXVsdHMgdG8gMzAgZGF5c1xuXHQgICAgICAgICAqL1xuXHQgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNvb2tpZShrZXksIHZhbHVlLCBleHApIHtcblx0ICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuXHQgICAgICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoZXhwICogMjQgKiA2MCAqIDYwICogMTAwMCkpO1xuXHQgICAgICAgICAgICB2YXIgZXhwaXJlcyA9IFwiOyBleHBpcmVzPVwiICsgZGF0ZS50b0dNVFN0cmluZygpO1xuXHQgICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBrZXkgKyBcIj1cIiArIHZhbHVlICsgZXhwaXJlcyArIFwiOyBwYXRoPS9cIjtcblx0ICAgICAgICB9XG5cblx0ICAgICAgICAvKipcblx0ICAgICAgICAgKiBSZXR1cm5zIGNvbnRlbnRzIG9mIGNvb2tpZVxuXHQgICAgICAgICAqIEBwYXJhbSAga2V5ICAgICAgIFRoZSBrZXkgb3IgaWRlbnRpZmllciBmb3IgdGhlIHN0b3JlXG5cdCAgICAgICAgICovXG5cdCAgICAgICAgZnVuY3Rpb24gcmVhZENvb2tpZShrZXkpIHtcblx0ICAgICAgICAgICAgdmFyIG5hbWVFUSA9IGtleSArIFwiPVwiO1xuXHQgICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcblx0ICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1heCA9IGNhLmxlbmd0aDsgaSA8IG1heDsgaSsrKSB7XG5cdCAgICAgICAgICAgICAgICB2YXIgYyA9IGNhW2ldO1xuXHQgICAgICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09PSAnICcpIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7XG5cdCAgICAgICAgICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWVFUSkgPT09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cdCAgICAgICAgfVxuXHRcdCAgICB9O1xuICAgIH07XG5cblx0cmV0dXJuIHtcbiAgICAgICAgaW5pdDogaW5pdFxuICAgIH07XG5cbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
